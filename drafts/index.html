<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NYC Route Simulation (Mapbox)</title>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet" />
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; }
        #map { width: 100%; height: 90vh; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        mapboxgl.accessToken = "pk.eyJ1IjoidGlvbDkwOSIsImEiOiJjbTdhczMyNmQwNzc2Mm1vcW8xanoxOGUyIn0.kKCZG04gg2B5ElDWkqCdFQ";

        let map = new mapboxgl.Map({
            container: "map",
            style: "mapbox://styles/mapbox/streets-v11",
            center: [-74.0060, 40.7128], // NYC center
            zoom: 13
        });

        let marker;
        let stepIndex = 0, routeCoords = [];
        const speed = 100; // Speed in ms

        function getRoute(start, end) {
            let url = `https://api.mapbox.com/directions/v5/mapbox/driving/${start};${end}?geometries=geojson&access_token=${mapboxgl.accessToken}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    routeCoords = data.routes[0].geometry.coordinates.map(coord => [coord[0], coord[1]]);
                    
                    map.addLayer({
                        id: "route",
                        type: "line",
                        source: {
                            type: "geojson",
                            data: {
                                type: "Feature",
                                properties: {},
                                geometry: { type: "LineString", coordinates: routeCoords }
                            }
                        },
                        layout: { "line-join": "round", "line-cap": "round" },
                        paint: { "line-color": "#0074D9", "line-width": 5 }
                    });

                    marker = new mapboxgl.Marker().setLngLat(routeCoords[0]).addTo(map);
                    animateMarker();
                })
                .catch(error => console.error("Error fetching route:", error));
        }

        function animateMarker() {
            if (stepIndex < routeCoords.length) {
                marker.setLngLat(routeCoords[stepIndex]);
                stepIndex++;
                setTimeout(animateMarker, speed);
            }
        }

        // Example: Simulating route from Times Square to Brooklyn Bridge
        getRoute("-73.9855,40.7580", "-73.9969,40.7061");
    </script>
</body>
</html>
