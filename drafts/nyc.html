<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NYC Route Simulation (Mapbox)</title>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet" />
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; }
        #map { width: 100%; height: 90vh; }
        .controls {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 10px;
            border-radius: 5px;
            display: flex;
            gap: 10px;
        }
        button { padding: 5px 10px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="controls">
        <button onclick="startSimulation()">Start</button>
        <button onclick="pauseSimulation()">Pause</button>
        <button onclick="resumeSimulation()">Resume</button>
        <button onclick="prevStep()">Previous</button>
        <button onclick="nextStep()">Next</button>
    </div>

    <script>
        mapboxgl.accessToken = "pk.eyJ1IjoidGlvbDkwOSIsImEiOiJjbTdhczMyNmQwNzc2Mm1vcW8xanoxOGUyIn0.kKCZG04gg2B5ElDWkqCdFQ"; // Replace with your Mapbox API Key

        let map = new mapboxgl.Map({
            container: "map",
            style: "mapbox://styles/mapbox/streets-v11",
            center: [-74.0060, 40.7128], // NYC center
            zoom: 13
        });

        let marker, routeCoords = [], stepIndex = 0;
        let isPaused = false;
        const speed = 200; // Speed in ms

        function getRoute(start, end) {
            let url = `https://api.mapbox.com/directions/v5/mapbox/driving/${start};${end}?geometries=geojson&access_token=${mapboxgl.accessToken}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    routeCoords = data.routes[0].geometry.coordinates.map(coord => [coord[0], coord[1]]);
                    
                    map.addLayer({
                        id: "route",
                        type: "line",
                        source: {
                            type: "geojson",
                            data: {
                                type: "Feature",
                                properties: {},
                                geometry: { type: "LineString", coordinates: routeCoords }
                            }
                        },
                        layout: { "line-join": "round", "line-cap": "round" },
                        paint: { "line-color": "#0074D9", "line-width": 5 }
                    });

                    if (marker) marker.remove();
                    marker = new mapboxgl.Marker().setLngLat(routeCoords[0]).addTo(map);
                })
                .catch(error => console.error("Error fetching route:", error));
        }

        function animateMarker() {
            if (stepIndex < routeCoords.length && !isPaused) {
                marker.setLngLat(routeCoords[stepIndex]);
                stepIndex++;
                setTimeout(animateMarker, speed);
            }
        }

        function startSimulation() {
            isPaused = false;
            stepIndex = 0;
            animateMarker();
        }

        function pauseSimulation() {
            isPaused = true;
        }

        function resumeSimulation() {
            isPaused = false;
            animateMarker();
        }

        function prevStep() {
            if (stepIndex > 0) {
                stepIndex--;
                marker.setLngLat(routeCoords[stepIndex]);
            }
        }

        function nextStep() {
            if (stepIndex < routeCoords.length - 1) {
                stepIndex++;
                marker.setLngLat(routeCoords[stepIndex]);
            }
        }

        // Example: Simulating route from Times Square to Brooklyn Bridge
        getRoute("-73.9855,40.7580", "-73.9969,40.7061");
    </script>
</body>
</html>
